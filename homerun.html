<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Homerun</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.7/css/jquery.dataTables.css">
    
</head>

<body>
    
    <!-- Scripts -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
    <script src="client/jquery.dataTables.rowGrouping.js"></script>
</body>

<template name="layout">
    <header>
        {{> nav }}
    </header>
    <div class="row">
        <div class="col-lg-2"></div>
        <div class="col-lg-8">
            <div class="container">
                {{> yield}}
            </div>
        </div>
        <div class="col-lg-2"></div>
    </div>
</template>

<template name="nav">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Homerun</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Movimientos<span class="caret"></span></a>
                        <ul class="dropdown-menu multi-level" role="menu">
                            {{#each years}}
                            <li class="dropdown-submenu">
                                <a href="/balance/{{year}}">{{year}}</a>
                                <ul class="dropdown-menu multi-level" role="menu">
                                    {{#each months}}
                                    <li class="dropdown-submenu">
                                        <a href="/balance/{{../year}}/{{this}}">{{getMonthName this}}</a>
                                        <ul class="dropdown-menu">
                                            <li><a href="/expenses/{{../year}}/{{this}}">Gastos</a></li>
                                            <li><a href="/incomes/{{../year}}/{{this}}">Ingresos</a></li>
                                        </ul>
                                    </li>
                                    {{/each}}
                                </ul>
                            </li>
                            {{else}}
                            <li>
                                <a>No hay datos disponibles</a>
                            </li>
                            {{/each}}
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Añadir<span class="caret"></span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="/add/expense">Gasto</a></li>
                            <li><a href="/add/income">Ingreso</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
</template>

<template name="loading">
</template>

<template name="home">
    <h1>Homerun</h1>
    <a href="expenses">Ir a gastos</a>
</template>

<template name="404">
    <h1>404</h1>
    <h2>La página que buscas no existe</h2>
</template>

<template name="addTransaction">
    <div class="transaction">
        <form class="form add-transaction-form" role="form">
            <h2>Añadir {{type}}</h2>
            <label>Descripción</label>
            <input type="text" name="transaction-description" class="form-control" placeholder="Descripción" />
            
            <label>Categoría</label>
            <!-- <input type="text" name="transaction-category" class="form-control typeahead" placeholder="Categoría" -->
            <!--        autocomplete="off" spellcheck="off" data-provide="typeahead" data-source="categories"/> -->
            {{> inputAutocomplete settings=settings id="tCategory" name="transaction-category" class="form-control" placeholder="Categorías"}}
            
            <label>Cantidad</label>
            <input type="text" name="transaction-amount" class="form-control" placeholder="0,00" />

            <label>Tipo</label>
            <select id="type" name="transaction-type" class="form-control">
                <option value="Variable">Variable</option>
                <option value="Fijo">Fijo</option>
            </select>
            
            <label>Fecha</label>
            <input type="text" name="transaction-date" class="form-control" id="datepicker">
            <button class="btn btn-md btn-block btn-primary" id="add-transaction">Añadir</button>
        </form>
    </div>
    <div class="csv">
        <input type="file" id="csv-uploader" title="CSV" accept="text/csv">
	<button class="btn btn-lg btn-warning btn-block" id="csv-button">Subida masiva</button>
    </div>
</template>

<template name="transactionCategory">
    <span class="category">{{name}}</span>
</template>

<template name="transactionNotFoundCategory">
  <ul class="-autocomplete-list">
    <li class="-autocomplete-item new">
      <span class="category">{{text}} [Añadir]</span>
    </li>
  </ul>
</template>

<template name="expensesByYear">
    <h4>Gastos {{ year }}</h4>
    {{#if empty}}
    <h4>No hay gastos en esta fecha</h4>
    {{else}}
    {{> tableTransactions transactions=yearExpenses}}
    {{/if}}
</template>

<template name="expensesByMonth">
    <h4>Gastos {{ monthName }} <a href="/expenses/{{year}}">{{ year }}</a></h4>
    {{#if empty}}
    <h4>No hay gastos en esta fecha</h4>
    {{else}}
    {{> tableTransactions transactions=monthExpenses totalAmount=totalAmount}}
    {{/if}}
</template>

<template name="incomesByYear">
    <h4>Ingresos {{ year }}</h4>
    {{#if empty}}
    <h4>No hay ingresos en esta fecha</h4>
    {{else}}
    {{> tableTransactions transactions=yearIncomes}}
    {{/if}}
</template>

<template name="incomesByMonth">
    <h4>Ingresos {{ monthName }} <a href="/incomes/{{year}}">{{ year }}</a></h4>
    {{#if empty}}
    <h4>No hay ingresos en esta fecha</h4>
    {{else}}
    {{> tableTransactions transactions=monthIncomes totalAmount=totalAmount}}
    {{/if}}
</template>

<template name="balanceTableByMonth">
    <h4>Balance</h4>
    {{#if empty}}
    <h4>No hay ingresos ni gastos en esta fecha</h4>
    {{else}}
    {{> tableBalance }}
    {{/if}}
</template>

<template name="balanceByYear">
    <div class="row">
        <h2>Balance {{year}}</h2>
    </div>
    <div class="row">
        {{> expensesByYear}}
    </div>
    <div class="row">
        {{> incomesByYear}}
    </div>
</template>

<template name="balanceByMonth">
    <div class="row">
        <h2>Balance {{monthName}} <a href="/balance/{{year}}">{{year}}</a></h2>
    </div>
    <div class="row">
        {{> expensesByMonth}}
    </div>
    <div class="row">
        {{> incomesByMonth}}
    </div>
    <div class="row">
        {{> balanceTableByMonth}}
    </div>
</template>

<template name="tableTransactions">
    <table class="transactions">
        <thead>
            <tr>
                <th>
                    Descripción
                </th>
                <th>
                    Categoría
                </th>
                <th>
                    Fecha
                </th>
                <th class="right">
                    Cantidad (€)
                </th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th></th>
                <th class="right">
                    Total
                </th>
                <th class="right">{{formatAmount totalAmount}}</th>
            </tr>
        </tfoot>
        <tbody>
            {{#each transactions}}
            <tr>
                <td>{{this.description}}</td>
                <td>{{this.category}}</td>
                <td>{{this.year}}-{{this.month}}-{{this.day}}</td>
                <td class="right">{{this.amount}}</td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</template>

<template name="tableBalance">
    <table class="transactions balance">
        <thead>
            <tr>
                <th>
                    Tipo
                </th>
                <th class="right">
                    Cantidad (€)
                </th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th class="right">
                    Total
                </th>
                <th class="right {{balanceResult}}">{{formatAmount totalBalance}}</th>
            </tr>
        </tfoot>
        <tbody>
            <tr>
                <td>Ingresos</td>
                <td class="right">{{formatAmount totalIncomes}}</td>
            </tr>
            <tr>
                <td>Gastos</td>
                <td class="right">{{formatAmount totalExpenses}}</td>
            </tr>
        </tbody>
    </table>
</template>

<template name="chart">
    <svg id="myChart">
    </svg>
</template>
